{{- /* =======================
     Theme toggle bootstrap
     ======================= */ -}}
{{- if (not site.Params.disableThemeToggle) }}
  {{- if (eq site.Params.defaultTheme "light") }}
    <script>
      if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
      }
    </script>
  {{- else if (eq site.Params.defaultTheme "dark") }}
    <script>
      if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark');
      }
    </script>
  {{- else }}
    <script>
      if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
      } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
      } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
      }
    </script>
  {{- end }}
{{- else if (and (ne site.Params.defaultTheme "light") (ne site.Params.defaultTheme "dark"))}}
  <script>
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.body.classList.add('dark');
    }
  </script>
{{- end }}

<header class="header">
  <nav class="nav header-bar">
    <!-- Left: (optional) logo + inline menu; NO site title text -->
    <div class="header-left">

      {{/* --- Logo (tuỳ chọn). Chỉ render nếu có icon hoặc iconSVG --- */}}
      {{- $hasIcon := or site.Params.label.icon site.Params.label.iconSVG -}}
      {{- if $hasIcon }}
        <a class="brand-logo" href="{{ "" | absLangURL }}" accesskey="h" title="Home (Alt + H)">
          {{- if site.Params.label.icon }}
            {{- $img := resources.Get site.Params.label.icon }}
            {{- if $img }}
              {{- $processableFormats := (slice "jpg" "jpeg" "png" "tif" "bmp" "gif") -}}
              {{- if hugo.IsExtended -}}
                {{- $processableFormats = $processableFormats | append "webp" -}}
              {{- end -}}
              {{- $prod := (hugo.IsProduction | or (eq site.Params.env "production")) }}
              {{- if and (in $processableFormats $img.MediaType.SubType) (eq $prod true)}}
                {{- if site.Params.label.iconHeight }}
                  {{- $img = $img.Resize (printf "x%d" site.Params.label.iconHeight) }}
                {{ else }}
                  {{- $img = $img.Resize "x30" }}
                {{- end }}
              {{- end }}
              <img src="{{ $img.Permalink }}" alt="Logo" height="{{- site.Params.label.iconHeight | default "30" -}}">
            {{- else }}
              <img src="{{- site.Params.label.icon | absURL -}}" alt="Logo" height="{{- site.Params.label.iconHeight | default "30" -}}">
            {{- end -}}
          {{- else if hasPrefix site.Params.label.iconSVG "<svg" }}
            {{ site.Params.label.iconSVG | safeHTML }}
          {{- end -}}
        </a>
      {{- end }}

      {{- /* Inline menu ngay cạnh (hoặc thay thế) logo */ -}}
      {{- with site.Menus.main }}
      <ul class="title-menu">
        {{- range . }}
        <li><a href="{{ .URL | absLangURL }}">{{ .Name }}</a></li>
        {{- end }}
      </ul>
      {{- end }}
    </div>

    <!-- Right: theme toggle + lang switch -->
    <div class="header-right">
      {{- if (not site.Params.disableThemeToggle) }}
      <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
        <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
          fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
        <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
          fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
      </button>
      {{- end }}

      {{- if (not site.Params.disableLangToggle) }}
        {{- $lang := .Lang }}
        {{- with site.Home.Translations }}
        <ul class="lang-switch">
          {{- range . -}}
            {{- if ne $lang .Lang }}
            <li>
              <a href="{{- .Permalink -}}"
                 title="{{ .Language.Params.languageAltTitle | default (.Language.LanguageName | emojify) | default (.Lang | title) }}"
                 aria-label="{{ .Language.LanguageName | default (.Lang | title) }}">
                 {{- if (and site.Params.displayFullLangName (.Language.LanguageName)) -}}
                   {{- .Language.LanguageName | emojify -}}
                 {{- else -}}
                   {{- .Lang | title -}}
                 {{- end -}}
              </a>
            </li>
            {{- end -}}
          {{- end }}
        </ul>
        {{- end }}
      {{- end }}
    </div>
  </nav>
</header>

{{- /* ================
     Styles (scoped)
     ================ */ -}}
<style>
  .header-bar{
    display:flex; justify-content:space-between; align-items:center; gap:.75rem;
  }
  .header-left{
    display:flex; align-items:center; gap:1rem;
  }
  .brand-logo{
    display:inline-flex; align-items:center;
  }

  /* Menu cạnh trái – giữ cỡ lớn (bằng site title cũ) */
  .title-menu{
    display:flex; align-items:center; gap:1rem;
    margin:0; padding:0; list-style:none;
  }
  .title-menu a{
    font-size:1.5rem; font-weight:800; text-decoration:none; opacity:.9;
  }
  .title-menu a:hover{ opacity:1; }

  .header-right{ display:flex; align-items:center; gap:.75rem; }
  .lang-switch{ display:flex; gap:.5rem; margin:0; padding:0; list-style:none; }

  /* Ẩn menu mặc định của PaperMod (nếu có) */
  #menu{ display:none !important; }

  @media (max-width:640px){
    .title-menu a{ font-size:1.25rem; font-weight:700; }
    .header-left{ gap:.75rem; }
  }
</style>
